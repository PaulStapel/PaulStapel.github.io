<!DOCTYPE html>

<script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><script data-goatcounter="https://paulstapel.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tsparticles/preset-stars@3/tsparticles.preset.stars.bundle.min.js"></script>


<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles/style.css">
    <link rel="stylesheet" href="/styles/syntax.css">
    <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet'>

    

    
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://paulstapel.com/favicons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://paulstapel.com/favicons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://paulstapel.com/favicons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://paulstapel.com/favicons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://paulstapel.com/favicons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://paulstapel.com/favicons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://paulstapel.com/favicons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://paulstapel.com/favicons/apple-touch-icon-152x152.png" />

    
    <link rel="icon" type="image/png" href="https://paulstapel.com/favicons/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="https://paulstapel.com/favicons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="https://paulstapel.com/favicons/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="https://paulstapel.com/favicons/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="https://paulstapel.com/favicons/favicon-128.png" sizes="128x128" />

    
    <meta name="application-name" content="Your Website Name" />
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="https://paulstapel.com/favicons/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="https://paulstapel.com/favicons/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="https://paulstapel.com/favicons/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="https://paulstapel.com/favicons/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="https://paulstapel.com/favicons/mstile-310x310.png" />
    <style>
    body {
        font-family: 'Lato';
    }
    </style>
    <title>Paul's Particles</title>
</head>
<body>
    <div class="container">
      <nav class="navbar">
  <div class="logo">
    
    <a href="/" class="site-name hoverlink">Paul's Particles</a>
    
  </div class="nav-elements">
    <div class="toggle">
      <svg
        width="20px"
        height="20px"
        viewBox="-0.14 0 20.03 20.03"
        fill="#000000"
      >
        <g id="moon-alt" transform="translate(-2.25 -2)">
          <path
            id="secondary"
            fill="#FFFFF0"
            d="M21,12A9,9,0,0,1,3.25,14.13,6.9,6.9,0,0,0,8,16,7,7,0,0,0,11.61,3H12a9,9,0,0,1,9,9Z"
          ></path>
        </g>
      </svg>
      <div class="ball" ></div>
      <svg width="20px" height="20px" viewBox="0 0 20 20" fill="#000000">
        <g id="sun" transform="translate(-2 -2)">
          <circle
            id="secondary"
            fill="#FFFFF0"
            cx="4"
            cy="4"
            r="4"
            transform="translate(8 8)"
          ></circle>
          <path
            id="primary"
            d="M12,3V4M5.64,5.64l.7.7M3,12H4m1.64,6.36.7-.7M12,21V20m6.36-1.64-.7-.7M21,12H20M18.36,5.64l-.7.7M12,8a4,4,0,1,0,4,4A4,4,0,0,0,12,8Z"
            fill="none"
            stroke="#ffe01b"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
          ></path>
        </g>
      </svg>
    </div >


    <div class="links">
    <a href="/" class="hoverlink">Particles</a>
    
    
    <a href="/about-me/about-me" class="hoverlink">About</a>
    <a href="/codex/codex-meae-mentis" class="hoverlink">Codex</a>
    <a href="/categories/meditation" class="hoverlink">Meditation</a>
    <a href="/categories/daily-drops/" class="hoverlink">Drops</a>
    <a href="/categories/recipe/" class="hoverlink">Recipes</a>
  </div>

  <div class="search-container">
      <input type="text" placeholder="Search...">
      <div class="search"></div>
    </div>


  <header class="borgir"> 
  <input type="checkbox" id="menyAvPaa">
  <label id="burger" for="menyAvPaa">
      <div></div>
      <div></div>
      <div></div>
  </label>
<div id="meny">
  <div id="tsparticles"></div>
  <div class="moblinks">
  <a href="/" class="hoverlink">Particles</a>
  
  
  <a href="/about-me/about-me" class="hoverlink">About</a>
  <a href="/codex/codex-meae-mentis" class="hoverlink">Codex</a>
  <a href="/categories/meditation/" class="hoverlink">Meditation</a>
  <a href="/categories/daily-drops/" class="hoverlink">Drops</a>
  <a href="/categories/recipe/" class="hoverlink">Recipes</a>
</div>
</div>


</header>

</nav>
      <script src="/js/app.js"> </script>
      


<div class="single">
   <div class="singleHead">
      <div class="singleHeadText">
        <h1 class="singleHeadTitle">How to Manage Player Input - Part 2: Events</h1> 
        <p class="singleHeadDesc">Exploring input handling inside of games using events</p>
        <time class="singleDate"><em>6 Jul, 2025</em></time>
        <div class="singleCategories">
            
            <a class="singleCategory" href=http://localhost:1313/categories/coding/>coding</a> 
            
            <a class="singleCategory" href=http://localhost:1313/categories/gamedev/>gameDev</a> 
            
            <a class="singleCategory" href=http://localhost:1313/categories/c%23/>C#</a> 
            
        </div>
      </div>
   </div>
   <div class="singleBottom">
    
    <div class="singleContent"><p>Here we are again, back with the second part of this 2-part series on input handling. Last time, we looked into how to use polling, commands and states to represent a lot of what can be done with inputs. Complex games, however, operate in a slightly different way. We will be looking at three ways to use events in our input handling, and how this can further elevate our engine.</p>
<h2 id="quick-recap">Quick recap</h2>
<p>We wish to have a system that is:</p>
<ul>
<li><strong>configurable</strong>: modern games should have mappable controls among other accessibility options</li>
<li><strong>extensible</strong>: we should be able to easily add new controls without having to change the whole codebase</li>
<li><strong>efficient</strong>: input-lag is a sure-fire way to make a lame game</li>
<li><strong>decoupled</strong>: we want to make our system as versatile and testable as possible</li>
</ul>
<p>Furthermore, we will assume a simple API exists from which we can extract the inputs of our device, and that we have a mainloop that looks roughly like</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C#" data-lang="C#"><span class="line"><span class="cl"><span class="c1">// An overly simplified main loop for illustration purposes</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="k">class</span> <span class="nc">Game</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">Main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">inputAPI</span> <span class="p">=</span> <span class="k">new</span> <span class="n">InputAPI</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">player</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Player</span><span class="p">(</span><span class="n">inputAPI</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">var</span> <span class="n">entities</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">GameEntity</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">player</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">entity</span> <span class="k">in</span> <span class="n">entities</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">entity</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">entity</span><span class="p">.</span><span class="n">Draw</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Let&rsquo;s now get into the meat of our system.</p>
<h2 id="event-based-input-handling">Event-Based Input Handling</h2>
<p>Instead of processing a command each time a button is pressed, we will be seperating the input updates from the standard updates that happen inside of an entity. Inside of an ECS architecture, we have Entities, Components and Systems. Each system should know only about itself, and events are the abstraction that helps us achieve this. An event encapsulates a request, and delegates that task to another system.</p>
<p>For example, whenever the phsyics system detects that an entity hits the ground, it may send an event EntityHitGround to the even manager. This can then be picked up on by the sound system, which will play a thunk sound in response. This way, the physics engine does not need to know anything about the sound system, and it doesn&rsquo;t even care if a sound is played because of its event. It simply sends out the event, and other systems can figure out if they want to deal with it.</p>
<p>The way this is managed is by a subscriber/publisher pattern. You could make every system in your game a publisher, but this becomes very hairy if you employ a lot of systems. Instead, you create one large EventManager that acts as a central publisher with different event-types which can be subscribed to. A system notifies the publisher of an event, and then the publisher distributes it to every system that wants to listen to it.</p>
<p>An implementation would look someting like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C#" data-lang="C#"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">interface</span> <span class="nc">IEventListener</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">OnEvent</span><span class="p">(</span><span class="n">Event</span> <span class="n">evt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="k">class</span> <span class="nc">Event</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">EventType</span> <span class="n">type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ... Possibly other data like time or ID, depending on game</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">EventType</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">InputEvent</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">// ... etc. </span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="k">class</span> <span class="nc">EventManager</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Here, EventType is an enum for demonstration purpose. </span>
</span></span><span class="line"><span class="cl">    <span class="c1">// It would usually be better to use generics on concrete Event classes. </span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">EventType</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IEventListener</span><span class="p">&gt;&gt;</span> <span class="n">_listeners</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">Subscribe</span><span class="p">(</span><span class="n">EventType</span> <span class="n">type</span><span class="p">,</span> <span class="n">IEventListener</span> <span class="n">listener</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(!</span><span class="n">_listeners</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="n">type</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">_listeners</span><span class="p">[</span><span class="n">type</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IEventListener</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(!</span><span class="n">_listeners</span><span class="p">[</span><span class="n">type</span><span class="p">].</span><span class="n">Contains</span><span class="p">(</span><span class="n">listener</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">_listeners</span><span class="p">[</span><span class="n">type</span><span class="p">].</span><span class="n">Add</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Rather expensive depending on amount of listeners per event type !</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">UnSubscribe</span><span class="p">(</span><span class="n">EventType</span> <span class="n">type</span><span class="p">,</span> <span class="n">IEventListener</span> <span class="n">listener</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">_listeners</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">list</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">list</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="n">Count</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">_listeners</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">Publish</span><span class="p">(</span><span class="n">Event</span> <span class="n">evt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">EventType</span> <span class="n">type</span> <span class="p">=</span> <span class="k">event</span><span class="p">.</span><span class="n">type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">_listeners</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">list</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">listener</span> <span class="k">in</span> <span class="n">list</span><span class="p">.</span><span class="n">ToArray</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">listener</span><span class="p">.</span><span class="n">OnEvent</span><span class="p">(</span><span class="n">evt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Most importantly, we can call for each of our Player in our game the Subscribe call at initialisation to, for example, subscribe to all InputEvents. Then, we would create a InputSystem that sends InputEvent which the player can pick up on. The InputSystem could then handle all the logic for what inputs get routed to which player, and we have then effectively decoupled our Entities from our Inputs. The player class could look something like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C#" data-lang="C#"><span class="line"><span class="cl"><span class="c1">// Event implementation</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">Player</span> <span class="p">:</span> <span class="n">GameEntity</span><span class="p">,</span> <span class="n">IEventListener</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Player</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">EventManager</span><span class="p">.</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">EventType</span><span class="p">.</span><span class="n">InputEvent</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// .. some other code</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">OnEvent</span><span class="p">(</span><span class="n">Event</span> <span class="n">evt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="k">is</span> <span class="n">InputEvent</span> <span class="n">inputEvent</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">inputEvent</span><span class="p">.</span><span class="n">command</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">Update</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Internal logic for updating outside of input (Using components for example)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>And there you have it, a robust way to handle inputs using events. The events are dispatched immediately once called, and can be handled by some InputSystem however you see fit.</p>
<p>This system is still configurable, as we can have the InputSystem handle all of the logic in the user inputs. It may even delay some actions and only fire them off when a combo is completely finished for example. It doesn&rsquo;t care about the Player at all, and can just keep doing its own thing.</p>
<p>The system is also extensible, as we can create different InputEvents holding different commands. When we want to implement some new control, we need only implement the command and add it to our InputSystem.</p>
<p>The system is the slowest we have seen so far, as we route our events via the eventmanager this time, having to search for all listeners to the event and all. It may occur that some listener actually isn&rsquo;t going to do anything with the event we send, and thus, this takes some extra time. This would usually not be a bottleneck however, and this is not much to worry about.</p>
<p>Finally, we can see that the system is decoupled, as we don&rsquo;t even have to use a Dependency Injection of the InputSystem into our Player class in order to get it to read inputs. We only need one large central EventManager, but this can be a very clean way to couple the different systems in your game safely.</p>
<p>In this system, we must keep in mind that infinite loops may occur where A responds to B responds to A responds to B etc. You could ensure Events never trigger new events, but this may be unavoidable. You could also track call depth or event ID to ensure you don&rsquo;t infinitely recurse.</p>
<p>We may improve upon this design still though, while also solving this infinite loop in the process.</p>
<h2 id="event-based-input-handling-with-queueing">Event-Based Input Handling With Queueing</h2>
<p>We create a double-buffered event queue inside of our EventManger, like so:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C#" data-lang="C#"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="k">class</span> <span class="nc">EventManager</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Here, EventType is an enum for demonstration purpose. </span>
</span></span><span class="line"><span class="cl">    <span class="c1">// It would usually be better to use generics on concrete Event classes. </span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">EventType</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IEventListener</span><span class="p">&gt;&gt;</span> <span class="n">_listeners</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Queue</span><span class="p">&lt;</span><span class="n">Event</span><span class="p">&gt;</span> <span class="n">FrontQueue</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span> <span class="c1">// For adding</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Queue</span><span class="p">&lt;</span><span class="n">Event</span><span class="p">&gt;</span> <span class="n">BackQueue</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span> <span class="c1">// For processing</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">Subscribe</span><span class="p">(</span><span class="n">EventType</span> <span class="n">type</span><span class="p">,</span> <span class="n">IEventListener</span> <span class="n">listener</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(!</span><span class="n">_listeners</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="n">type</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">_listeners</span><span class="p">[</span><span class="n">type</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IEventListener</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(!</span><span class="n">_listeners</span><span class="p">[</span><span class="n">type</span><span class="p">].</span><span class="n">Contains</span><span class="p">(</span><span class="n">listener</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">_listeners</span><span class="p">[</span><span class="n">type</span><span class="p">].</span><span class="n">Add</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Rather expensive depending on amount of listeners per event type !</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">UnSubscribe</span><span class="p">(</span><span class="n">EventType</span> <span class="n">type</span><span class="p">,</span> <span class="n">IEventListener</span> <span class="n">listener</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">_listeners</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">list</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">list</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="n">Count</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">_listeners</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">PublishEvent</span><span class="p">(</span><span class="n">Event</span> <span class="n">evt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">FrontQueue</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">(</span><span class="n">evt</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Imediately process the event. </span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">Fire</span><span class="p">(</span><span class="n">Event</span> <span class="n">evt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">EventType</span> <span class="n">type</span> <span class="p">=</span> <span class="n">evt</span><span class="p">.</span><span class="n">Type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">_listeners</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">list</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">listener</span> <span class="k">in</span> <span class="n">list</span><span class="p">.</span><span class="n">ToArray</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">listener</span><span class="p">.</span><span class="n">OnEvent</span><span class="p">(</span><span class="n">evt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">ProcessEventQueue</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Swap front and back queues</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="n">FrontQueue</span><span class="p">,</span> <span class="n">BackQueue</span><span class="p">)</span> <span class="p">=</span> <span class="p">(</span><span class="n">BackQueue</span><span class="p">,</span> <span class="n">FrontQueue</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="p">(</span><span class="n">BackQueue</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">var</span> <span class="n">evt</span> <span class="p">=</span> <span class="n">BackQueue</span><span class="p">.</span><span class="n">Dequeue</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">Fire</span><span class="p">(</span><span class="n">evt</span><span class="p">);</span> <span class="c1">// Dispatch immediately from queue</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>This has the same benefits as our previous event based input handling, at the cost of a little extra complexity in managing the Events and working with the queue.</p>
<p>What we gain is the ability to very easily delay our commands based on time and the ability to have full control over when Events will be handled. For inputs, this can be useful for charged attacks for example. A charged attack may send a StartCharging Event as well as a timed ReleaseCharge Event. This way, all logic that needs to be handled for that charge can be handled inside of that charging command.</p>
<p>Be mindful if you wish to use this pattern, as it ads complexity where it may be critical for your game to have none. However, if you know that your game will have a plethora of moving parts that need to communicate temporally with eachother, than this type of input handling would fit perfectly.</p>
<h2 id="fucntional-event-based-input-handling">Fucntional Event-Based Input Handling</h2>
<p>Finally, we can take advantage of a feature of C# to make our event and thus input handling functional.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C#" data-lang="C#"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="k">class</span> <span class="nc">EventManager</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="k">readonly</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">EventType</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Event</span><span class="p">&gt;&gt;</span> <span class="n">_listeners</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">Subscribe</span><span class="p">(</span><span class="n">EventType</span> <span class="n">type</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Event</span><span class="p">&gt;</span> <span class="n">handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">_listeners</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="n">type</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">_listeners</span><span class="p">[</span><span class="n">type</span><span class="p">]</span> <span class="p">+=</span> <span class="n">handler</span><span class="p">;</span> <span class="c1">// Syntactic sugar for adding listeners</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">_listeners</span><span class="p">[</span><span class="n">type</span><span class="p">]</span> <span class="p">=</span> <span class="n">handler</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">Unsubscribe</span><span class="p">(</span><span class="n">EventType</span> <span class="n">type</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Event</span><span class="p">&gt;</span> <span class="n">handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">_listeners</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="n">type</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">_listeners</span><span class="p">[</span><span class="n">type</span><span class="p">]</span> <span class="p">-=</span> <span class="n">handler</span><span class="p">;</span> <span class="c1">// Syntactic sugar for removing listeners</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">_listeners</span><span class="p">[</span><span class="n">type</span><span class="p">]</span> <span class="p">==</span> <span class="kc">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">_listeners</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">Publish</span><span class="p">(</span><span class="n">Event</span> <span class="n">evt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">_listeners</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">evt</span><span class="p">.</span><span class="n">Type</span><span class="p">,</span> <span class="k">out</span> <span class="kt">var</span> <span class="n">handler</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">handler</span><span class="p">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">evt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Here, we have used the Action delegates to let us specify handler functions that deal with the events inside of a class.</p>
<p>For example, for a player, it would then look like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C#" data-lang="C#"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">Player</span> <span class="p">:</span> <span class="n">GameEntity</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Player</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">EventManager</span><span class="p">.</span><span class="n">Subscribe</span><span class="p">(</span><span class="n">EventType</span><span class="p">.</span><span class="n">InputEvent</span><span class="p">,</span> <span class="n">HandleInput</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">HandleInput</span><span class="p">(</span><span class="n">Event</span> <span class="n">evt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">evt</span> <span class="k">is</span> <span class="n">InputEvent</span> <span class="n">inputEvent</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">inputEvent</span><span class="p">.</span><span class="n">Command</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">Update</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Update logic here</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>This approach frees us from that pesky IEventListener interface, and cleans up our code quite a bit. It is a little more advanced however, so sticking with the familiar OOP approach is also valid. Besides that, it allows you to pass a Lambda function as a listener, which can be ideal for testing and logging. All with all, this is also a very clean way of handling inputs for your game system.</p>
<h2 id="final-remarks">Final remarks</h2>
<p>We have gone over quite a few ways to handle input. From humble beginnings with our naive approach to Functional Event-Based Input Handling, we have seen quite some different techniques. This article was a way for me to sort out my thoughts about this topic, as I have been struggling with it quite a bit this weekend, and I felt that it finally began to click after having implemented and played around with these.</p>
<p>Note that none of these input systems are exactly plug-and-play for any engine, as a lot of how your Inputs work depends on the kind of game you are making. I do hope that this has helped enumerate some of the most important options you should consider when creating such a system, and that it has taught you a thing or two about (high-level) game engine architecture.</p>
<p>There are many ways to go from here. Maybe you want to use some of this, but the Command pattern for your inputs doesn&rsquo;t sit right with you. Or maybe you want to use components, with only certain components dealing with the inputs inside of a Player class. Maybe you want to ditch all of this alltogether and create a new and contemporary input handling method. Whatever it may be, feel free to reach out with possible improvements or alternate designs that you find interesting enough to mention. I&rsquo;d love to hear about them, and maybe I&rsquo;ll write about those as well in the future.</p>
<h2 id="signing-off-have-a-lovely-day">Signing off, have a lovely day!</h2>
</div>
   </div>
</div>

      <div class="footer">
  <div class="footerLinks">
    <a href="/">Paul's particles</a> |
    
    <a href="/set-up/set-up">Setup</a> |
    <a href="/about-me/about-me">About</a> |
    <a href="/codex/codex-meae-mentis">Codex</a> |
    <a href="/categories/meditation" >Meditation</a> |
    <a href="/categories/daily-drops">Drops</a> | 
    <a href="/categories/recipe/">Recipes</a>
  </div>
  <div class="social">
    <a href="https://github.com/PaulStapel">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16">
        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8"/>
      </svg>
    </a>
    <a href="https://www.linkedin.com/in/paul-stapel/">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16">
        <path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z"/>
      </svg>
  </a>
  <a href="https://www.instagram.com/justpaulstapel/">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-instagram" viewBox="0 0 16 16">
    <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.9 3.9 0 0 0-1.417.923A3.9 3.9 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.9 3.9 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.9 3.9 0 0 0-.923-1.417A3.9 3.9 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599s.453.546.598.92c.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.5 2.5 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.5 2.5 0 0 1-.92-.598 2.5 2.5 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233s.008-2.388.046-3.231c.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92s.546-.453.92-.598c.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92m-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217m0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334"/>
  </svg>
  </a>
  
  </div>
  </div>
  
</div>

    </div>
</body>
</html>